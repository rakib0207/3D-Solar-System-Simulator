<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cosmic Explorer Pro - 3D Solar System</title>
    <!-- Add Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Three.js from CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Orbitron', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: radial-gradient(ellipse at bottom, #1B2735 0%, #090A0F 100%);
            color: #e0e0ff;
            min-height: 100vh;
            overflow: hidden;
        }
        
        header {
            text-align: center;
            padding: 15px;
            background: rgba(10, 10, 30, 0.5);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(100, 100, 255, 0.2);
            z-index: 10;
            position: relative;
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 5px;
            background: linear-gradient(to right, #8a2be2, #4facfe, #00f2fe);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 15px rgba(138, 43, 226, 0.7);
            letter-spacing: 2px;
        }
        
        .subtitle {
            font-size: 1rem;
            opacity: 0.8;
            max-width: 700px;
            margin: 0 auto;
            font-weight: 300;
        }
        
        .main-container {
            display: flex;
            height: calc(100vh - 80px);
            position: relative;
        }
        
        #solarSystem {
            flex: 1;
            position: relative;
        }
        
        .dashboard {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 15px;
            z-index: 5;
            flex-wrap: wrap;
            justify-content: center;
            max-width: 95%;
            padding: 10px;
        }
        
        .control-btn {
            background: rgba(15, 15, 40, 0.7);
            border: 1px solid rgba(100, 100, 255, 0.3);
            color: white;
            padding: 12px 20px;
            border-radius: 30px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
            backdrop-filter: blur(5px);
            transition: all 0.3s ease;
        }
        
        .control-btn:hover {
            background: rgba(138, 43, 226, 0.3);
            transform: translateY(-2px);
        }
        
        .control-btn.active {
            background: rgba(138, 43, 226, 0.5);
            box-shadow: 0 0 15px rgba(138, 43, 226, 0.5);
        }
        
        .planet-explorer {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(5, 5, 15, 0.95);
            z-index: 100;
            display: flex;
            flex-direction: column;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.5s ease;
            backdrop-filter: blur(10px);
        }
        
        .planet-explorer.active {
            opacity: 1;
            pointer-events: all;
        }
        
        .explorer-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border-bottom: 1px solid rgba(100, 100, 255, 0.2);
        }
        
        .explorer-title {
            font-size: 2rem;
            background: linear-gradient(to right, #8a2be2, #4facfe);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .close-explorer {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        
        .close-explorer:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .explorer-content {
            display: flex;
            flex: 1;
            padding: 20px;
            gap: 30px;
            overflow: hidden;
        }
        
        .planet-visual {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        .planet-model {
            width: 300px;
            height: 300px;
            position: relative;
        }
        
        .planet-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 20px;
            width: 100%;
            max-width: 500px;
        }
        
        .stat-card {
            background: rgba(30, 30, 60, 0.5);
            border-radius: 10px;
            padding: 15px;
            border-left: 3px solid #8a2be2;
        }
        
        .stat-title {
            font-size: 0.8rem;
            opacity: 0.7;
            margin-bottom: 5px;
        }
        
        .stat-value {
            font-size: 1.2rem;
            color: #4facfe;
            font-weight: bold;
        }
        
        .planet-info {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }
        
        .info-section {
            margin-bottom: 30px;
        }
        
        .info-title {
            font-size: 1.3rem;
            margin-bottom: 15px;
            color: #8a2be2;
            border-bottom: 1px solid rgba(100, 100, 255, 0.2);
            padding-bottom: 5px;
        }
        
        .info-text {
            line-height: 1.6;
            margin-bottom: 15px;
        }
        
        .info-highlights {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        
        .highlight {
            background: rgba(30, 30, 60, 0.5);
            padding: 10px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .highlight i {
            color: #4facfe;
            font-size: 1.2rem;
        }
        
        .missions {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .mission-tag {
            background: rgba(79, 172, 254, 0.2);
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
        }
        
        .navigation-arrows {
            position: absolute;
            top: 50%;
            width: 100%;
            display: flex;
            justify-content: space-between;
            padding: 0 20px;
            transform: translateY(-50%);
            pointer-events: none;
        }
        
        .nav-arrow {
            background: rgba(15, 15, 40, 0.7);
            border: none;
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            cursor: pointer;
            pointer-events: all;
            transition: all 0.3s ease;
        }
        
        .nav-arrow:hover {
            background: rgba(138, 43, 226, 0.5);
            transform: scale(1.1);
        }
        
        .system-overview {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(15, 15, 40, 0.7);
            padding: 15px;
            border-radius: 15px;
            border: 1px solid rgba(100, 100, 255, 0.2);
            max-width: 250px;
            backdrop-filter: blur(5px);
        }
        
        .overview-title {
            font-size: 1.1rem;
            margin-bottom: 10px;
            color: #8a2be2;
        }
        
        .planet-list {
            list-style: none;
        }
        
        .planet-item {
            padding: 8px 0;
            border-bottom: 1px solid rgba(100, 100, 255, 0.1);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s ease;
        }
        
        .planet-item:hover {
            color: #4facfe;
            transform: translateX(5px);
        }
        
        .planet-color {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }
        
        .time-controls {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(15, 15, 40, 0.7);
            padding: 15px;
            border-radius: 15px;
            border: 1px solid rgba(100, 100, 255, 0.2);
            backdrop-filter: blur(5px);
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .time-display {
            font-size: 1.1rem;
            text-align: center;
            margin-bottom: 10px;
            color: #4facfe;
        }
        
        .speed-control {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .speed-value {
            min-width: 50px;
            text-align: center;
        }
        
        input[type="range"] {
            flex: 1;
            height: 5px;
            background: rgba(100, 100, 200, 0.2);
            border-radius: 3px;
            outline: none;
            -webkit-appearance: none;
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 15px;
            height: 15px;
            background: #8a2be2;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 0 8px rgba(138, 43, 226, 0.7);
        }
        
        .notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(15, 15, 40, 0.9);
            padding: 12px 25px;
            border-radius: 30px;
            border: 1px solid rgba(100, 100, 255, 0.3);
            z-index: 20;
            opacity: 0;
            transition: opacity 0.3s ease;
            backdrop-filter: blur(5px);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .notification.show {
            opacity: 1;
        }
        
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(ellipse at bottom, #1B2735 0%, #090A0F 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            transition: opacity 0.5s ease;
        }
        
        .loading-text {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: #e0e0ff;
            text-align: center;
        }
        
        .loading-bar {
            width: 300px;
            height: 4px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 2px;
            overflow: hidden;
        }
        
        .loading-progress {
            height: 100%;
            background: linear-gradient(to right, #8a2be2, #4facfe);
            width: 0%;
            transition: width 0.3s ease;
        }
        
        .planet-label {
            position: absolute;
            color: white;
            font-size: 14px;
            font-weight: bold;
            text-shadow: 0 0 5px black;
            pointer-events: none;
            background: rgba(0, 0, 0, 0.5);
            padding: 4px 10px;
            border-radius: 15px;
            white-space: nowrap;
            backdrop-filter: blur(3px);
            z-index: 1;
        }
        
        .search-container {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(15, 15, 40, 0.7);
            padding: 10px 15px;
            border-radius: 30px;
            border: 1px solid rgba(100, 100, 255, 0.2);
            backdrop-filter: blur(5px);
            display: flex;
            align-items: center;
            gap: 10px;
            z-index: 5;
        }
        
        .search-input {
            background: transparent;
            border: none;
            color: white;
            font-size: 1rem;
            width: 200px;
            outline: none;
        }
        
        .search-input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }
        
        .scale-indicator {
            position: absolute;
            bottom: 80px;
            left: 20px;
            background: rgba(15, 15, 40, 0.7);
            padding: 10px 15px;
            border-radius: 10px;
            border: 1px solid rgba(100, 100, 255, 0.2);
            backdrop-filter: blur(5px);
            font-size: 0.9rem;
        }
        
        .position-display {
            position: absolute;
            bottom: 20px;
            right: 20px;
            background: rgba(15, 15, 40, 0.7);
            padding: 10px 15px;
            border-radius: 10px;
            border: 1px solid rgba(100, 100, 255, 0.2);
            backdrop-filter: blur(5px);
            font-size: 0.9rem;
            max-width: 300px;
        }
        
        .tour-controls {
            position: absolute;
            top: 180px;
            left: 20px;
            background: rgba(15, 15, 40, 0.7);
            padding: 15px;
            border-radius: 15px;
            border: 1px solid rgba(100, 100, 255, 0.2);
            backdrop-filter: blur(5px);
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .tour-btn {
            background: rgba(138, 43, 226, 0.3);
            border: none;
            color: white;
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
        }
        
        .tour-btn:hover {
            background: rgba(138, 43, 226, 0.5);
        }
        
        .tour-btn.active {
            background: rgba(138, 43, 226, 0.7);
            box-shadow: 0 0 10px rgba(138, 43, 226, 0.5);
        }
        
        .search-results {
            position: absolute;
            top: 100%;
            left: 0;
            width: 100%;
            background: rgba(15, 15, 40, 0.9);
            border-radius: 0 0 15px 15px;
            max-height: 200px;
            overflow-y: auto;
            display: none;
            z-index: 10;
        }
        
        .search-result-item {
            padding: 10px 15px;
            cursor: pointer;
            border-bottom: 1px solid rgba(100, 100, 255, 0.1);
            transition: all 0.3s ease;
        }
        
        .search-result-item:hover {
            background: rgba(138, 43, 226, 0.3);
        }
        
        .search-result-item:last-child {
            border-bottom: none;
        }
        
        @media (max-width: 768px) {
            .dashboard {
                flex-wrap: wrap;
                justify-content: center;
                width: 90%;
            }
            
            .control-btn {
                padding: 10px 15px;
                font-size: 0.8rem;
            }
            
            .system-overview, .time-controls, .tour-controls {
                position: relative;
                top: auto;
                left: auto;
                max-width: 100%;
                margin: 10px;
            }
            
            .explorer-content {
                flex-direction: column;
                padding: 10px;
            }
            
            .planet-model {
                width: 200px;
                height: 200px;
            }
            
            h1 {
                font-size: 1.8rem;
            }
            
            .search-container {
                top: 80px;
                width: 90%;
            }
            
            .search-input {
                width: 100%;
            }
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="loading-screen" id="loadingScreen">
        <div class="loading-text">Initializing Cosmic Explorer Pro</div>
        <div class="loading-bar">
            <div class="loading-progress" id="loadingProgress"></div>
        </div>
    </div>
    
    <header>
        <h1><i class="fas fa-rocket"></i> COSMIC EXPLORER PRO</h1>
        <p class="subtitle">Advanced 3D Solar System with Realistic Textures, Moons, and More</p>
    </header>
    
    <div class="main-container">
        <div id="solarSystem"></div>
        
        <div class="search-container">
            <i class="fas fa-search"></i>
            <input type="text" class="search-input" placeholder="Search planets..." id="searchInput">
            <div class="search-results" id="searchResults"></div>
        </div>
        
        <div class="time-controls">
            <div class="time-display">SPEED: <span id="speedValue">1.0x</span></div>
            <div class="speed-control">
                <i class="fas fa-tachometer-alt"></i>
                <input type="range" id="speed" min="0" max="5" step="0.1" value="1">
                <div class="speed-value" id="speedDisplay">1.0x</div>
            </div>
            <button class="control-btn" id="pauseBtn">
                <i class="fas fa-pause"></i> PAUSE
            </button>
        </div>
        
        <div class="tour-controls">
            <div class="time-display">TOUR MODE</div>
            <button class="tour-btn" id="startTour">
                <i class="fas fa-play"></i> START TOUR
            </button>
            <button class="tour-btn" id="nextStop">
                <i class="fas fa-step-forward"></i> NEXT STOP
            </button>
        </div>
        
        <div class="system-overview">
            <div class="overview-title">SOLAR SYSTEM</div>
            <ul class="planet-list" id="planetList">
                <!-- Planets will be populated by JavaScript -->
            </ul>
        </div>
        
        <div class="dashboard">
            <button class="control-btn active" id="toggleOrbits">
                <i class="fas fa-circle"></i> ORBITS
            </button>
            <button class="control-btn active" id="toggleLabels">
                <i class="fas fa-tag"></i> LABELS
            </button>
            <button class="control-btn" id="autoRotate">
                <i class="fas fa-sync"></i> AUTO ROTATE
            </button>
            <button class="control-btn" id="resetView">
                <i class="fas fa-crosshairs"></i> RESET VIEW
            </button>
            <button class="control-btn active" id="toggleMoons">
                <i class="fas fa-moon"></i> MOONS
            </button>
            <button class="control-btn active" id="toggleTextures">
                <i class="fas fa-mountain"></i> TEXTURES
            </button>
        </div>
        
        <div class="scale-indicator" id="scaleIndicator">
            Distance Scale: 1 AU = 50 units
        </div>
        
        <div class="position-display" id="positionDisplay">
            Real-time positions loading...
        </div>
    </div>
    
    <div class="planet-explorer" id="planetExplorer">
        <div class="explorer-header">
            <h2 class="explorer-title" id="explorerPlanetName">Planet Name</h2>
            <button class="close-explorer" id="closeExplorer">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="explorer-content">
            <div class="planet-visual">
                <div class="planet-model" id="planetModel"></div>
                <div class="planet-stats" id="planetStats">
                    <!-- Stats will be populated by JavaScript -->
                </div>
            </div>
            <div class="planet-info">
                <div class="info-section">
                    <h3 class="info-title">Overview</h3>
                    <p class="info-text" id="planetOverview">Planet overview information will appear here.</p>
                </div>
                <div class="info-section">
                    <h3 class="info-title">Key Features</h3>
                    <div class="info-highlights" id="planetHighlights">
                        <!-- Highlights will be populated by JavaScript -->
                    </div>
                </div>
                <div class="info-section">
                    <h3 class="info-title">Moons</h3>
                    <div class="missions" id="planetMoons">
                        <!-- Moons will be populated by JavaScript -->
                    </div>
                </div>
                <div class="info-section">
                    <h3 class="info-title">Notable Missions</h3>
                    <div class="missions" id="planetMissions">
                        <!-- Missions will be populated by JavaScript -->
                    </div>
                </div>
            </div>
        </div>
        <div class="navigation-arrows">
            <button class="nav-arrow" id="prevPlanet">
                <i class="fas fa-chevron-left"></i>
            </button>
            <button class="nav-arrow" id="nextPlanet">
                <i class="fas fa-chevron-right"></i>
            </button>
        </div>
    </div>
    
    <div class="notification" id="notification">
        <i class="fas fa-info-circle"></i>
        <span id="notificationText">Notification message</span>
    </div>

    <script>
        // Check if Three.js loaded
        if (typeof THREE === 'undefined') {
            document.getElementById('solarSystem').innerHTML = `
                <div style="display:flex;align-items:center;justify-content:center;height:100%;color:white;font-size:1.2rem;text-align:center;padding:20px;">
                    ⚠️ Error: Three.js failed to load.<br>
                    Please check your internet connection and refresh.
                </div>
            `;
        } else {
            // Main variables
            let scene, camera, renderer, controls;
            let sun, planets = [], moons = [];
            let orbits = [];
            let labels = [];
            let selectedPlanet = null;
            let autoRotate = false;
            let simulationSpeed = 1.0;
            let isPaused = false;
            let currentPlanetIndex = 0;
            let showMoons = true;
            let showTextures = true;
            let isTourActive = false;
            let tourInterval;
            let comets = [];
            let planetMeshes = [];
            let labelsVisible = true; // Track labels visibility state
            
            // Enhanced planet data with descriptions, highlights, missions, and moons
            const planetData = [
                { 
                    name: "Mercury", 
                    radius: 1.5, 
                    distance: 25, 
                    speed: 0.04, 
                    color: 0xFDB813, 
                    type: "Terrestrial", 
                    diameter: "4,879 km", 
                    orbitalPeriod: "88 days",
                    rotationPeriod: "59 days",
                    temperature: "167°C",
                    gravity: "3.7 m/s²",
                    overview: "The smallest planet in our solar system and closest to the Sun. Mercury is only slightly larger than Earth's Moon. From the surface of Mercury, the Sun would appear more than three times as large as it does when viewed from Earth.",
                    highlights: [
                        "Closest planet to the Sun",
                        "Extreme temperature variations",
                        "No atmosphere to speak of",
                        "Heavily cratered surface"
                    ],
                    moons: ["None"],
                    missions: ["Mariner 10", "MESSENGER", "BepiColombo"]
                },
                { 
                    name: "Venus", 
                    radius: 2.5, 
                    distance: 35, 
                    speed: 0.015, 
                    color: 0xE79F6D, 
                    type: "Terrestrial", 
                    diameter: "12,104 km", 
                    orbitalPeriod: "225 days",
                    rotationPeriod: "243 days",
                    temperature: "464°C",
                    gravity: "8.87 m/s²",
                    overview: "Often called Earth's sister planet due to similar size and structure. Venus has a thick, toxic atmosphere filled with carbon dioxide and it's perpetually shrouded in thick, yellowish clouds of sulfuric acid.",
                    highlights: [
                        "Hottest planet in solar system",
                        "Thick, toxic atmosphere",
                        "Retrograde rotation",
                        "Volcanoes and mountains"
                    ],
                    moons: ["None"],
                    missions: ["Venera program", "Magellan", "Venus Express"]
                },
                { 
                    name: "Earth", 
                    radius: 2.7, 
                    distance: 45, 
                    speed: 0.01, 
                    color: 0x6B93D6, 
                    type: "Terrestrial", 
                    diameter: "12,756 km", 
                    orbitalPeriod: "365 days",
                    rotationPeriod: "24 hours",
                    temperature: "15°C",
                    gravity: "9.8 m/s²",
                    overview: "Our home planet is the only place we know of so far that's inhabited by living things. It's also the only planet with liquid water on the surface. Earth is the third planet from the Sun and the fifth largest in the solar system.",
                    highlights: [
                        "Only known life-bearing planet",
                        "71% surface covered by water",
                        "Protective magnetic field",
                        "Active plate tectonics"
                    ],
                    moons: ["Moon"],
                    missions: ["Apollo program", "ISS", "Hubble Telescope"]
                },
                { 
                    name: "Mars", 
                    radius: 2, 
                    distance: 55, 
                    speed: 0.008, 
                    color: 0xC1440E, 
                    type: "Terrestrial", 
                    diameter: "6,792 km", 
                    orbitalPeriod: "687 days",
                    rotationPeriod: "24.6 hours",
                    temperature: "-65°C",
                    gravity: "3.7 m/s²",
                    overview: "Mars is a cold desert world. It is half the size of Earth. Mars is sometimes called the Red Planet. It's red because of iron minerals in the soil oxidizing, or rusting.",
                    highlights: [
                        "Reddish appearance from iron oxide",
                        "Largest volcano in solar system",
                        "Evidence of past water flows",
                        "Two small moons"
                    ],
                    moons: ["Phobos", "Deimos"],
                    missions: ["Viking program", "Curiosity Rover", "Perseverance Rover"]
                },
                { 
                    name: "Jupiter", 
                    radius: 8, 
                    distance: 75, 
                    speed: 0.002, 
                    color: 0xD8CA9D, 
                    type: "Gas Giant", 
                    diameter: "142,984 km", 
                    orbitalPeriod: "12 years",
                    rotationPeriod: "9.9 hours",
                    temperature: "-110°C",
                    gravity: "24.8 m/s²",
                    overview: "Jupiter is the largest planet in our solar system. It's a gas giant with a prominent Great Red Spot - a giant storm bigger than Earth that has raged for hundreds of years.",
                    highlights: [
                        "Largest planet in solar system",
                        "Great Red Spot storm",
                        "79 known moons",
                        "Strong magnetic field"
                    ],
                    moons: ["Io", "Europa", "Ganymede", "Callisto"],
                    missions: ["Pioneer 10", "Voyager program", "Juno"]
                },
                { 
                    name: "Saturn", 
                    radius: 7, 
                    distance: 95, 
                    speed: 0.0009, 
                    color: 0xE3E0C0, 
                    type: "Gas Giant", 
                    diameter: "120,536 km", 
                    orbitalPeriod: "29 years",
                    rotationPeriod: "10.7 hours",
                    temperature: "-140°C",
                    gravity: "10.4 m/s²",
                    overview: "Adorned with thousands of beautiful ringlets, Saturn is unique among the planets. It's a gas giant like Jupiter. Saturn's rings are made mostly of chunks of ice and small amounts of carbonaceous dust.",
                    highlights: [
                        "Spectacular ring system",
                        "Least dense planet",
                        "62 confirmed moons",
                        "Hexagonal cloud pattern at north pole"
                    ],
                    moons: ["Titan", "Enceladus", "Mimas", "Rhea"],
                    missions: ["Pioneer 11", "Voyager program", "Cassini-Huygens"]
                },
                { 
                    name: "Uranus", 
                    radius: 5, 
                    distance: 115, 
                    speed: 0.0004, 
                    color: 0xC0C0C0, 
                    type: "Ice Giant", 
                    diameter: "51,118 km", 
                    orbitalPeriod: "84 years",
                    rotationPeriod: "17.2 hours",
                    temperature: "-195°C",
                    gravity: "8.7 m/s²",
                    overview: "Uranus rotates at a nearly 90-degree angle from the plane of its orbit. This unique tilt makes Uranus appear to spin on its side. It's an ice giant with a frozen, rocky core.",
                    highlights: [
                        "Rotates on its side",
                        "Faint ring system",
                        "27 known moons",
                        "Coldest planetary atmosphere"
                    ],
                    moons: ["Titania", "Oberon", "Umbriel", "Ariel"],
                    missions: ["Voyager 2"]
                },
                { 
                    name: "Neptune", 
                    radius: 5, 
                    distance: 135, 
                    speed: 0.0001, 
                    color: 0x4F79D5, 
                    type: "Ice Giant", 
                    diameter: "49,528 km", 
                    orbitalPeriod: "165 years",
                    rotationPeriod: "16.1 hours",
                    temperature: "-200°C",
                    gravity: "11.2 m/s²",
                    overview: "Neptune is dark, cold, and whipped by supersonic winds. It was the first planet located through mathematical calculations. Neptune is similar to Uranus in composition.",
                    highlights: [
                        "Strongest winds in solar system",
                        "Great Dark Spot storm",
                        "14 known moons",
                        "Faint and fragmented rings"
                    ],
                    moons: ["Triton", "Nereid", "Proteus"],
                    missions: ["Voyager 2"]
                }
            ];
            
            // Moon data
            const moonData = {
                "Earth": [
                    { name: "Moon", radius: 0.7, distance: 5, speed: 0.05, color: 0xAAAAAA }
                ],
                "Mars": [
                    { name: "Phobos", radius: 0.2, distance: 3, speed: 0.1, color: 0x888888 },
                    { name: "Deimos", radius: 0.15, distance: 4, speed: 0.08, color: 0x777777 }
                ],
                "Jupiter": [
                    { name: "Io", radius: 0.5, distance: 10, speed: 0.2, color: 0xFFAA00 },
                    { name: "Europa", radius: 0.45, distance: 12, speed: 0.18, color: 0xFFFFFF },
                    { name: "Ganymede", radius: 0.8, distance: 15, speed: 0.15, color: 0xBBBBBB },
                    { name: "Callisto", radius: 0.75, distance: 18, speed: 0.12, color: 0x999999 }
                ],
                "Saturn": [
                    { name: "Titan", radius: 0.7, distance: 12, speed: 0.15, color: 0xFFCC99 },
                    { name: "Enceladus", radius: 0.3, distance: 9, speed: 0.2, color: 0xFFFFFF },
                    { name: "Mimas", radius: 0.25, distance: 7, speed: 0.25, color: 0xCCCCCC },
                    { name: "Rhea", radius: 0.4, distance: 10, speed: 0.18, color: 0xDDDDDD }
                ],
                "Uranus": [
                    { name: "Titania", radius: 0.4, distance: 8, speed: 0.1, color: 0xAAAAAA },
                    { name: "Oberon", radius: 0.38, distance: 10, speed: 0.09, color: 0x999999 },
                    { name: "Umbriel", radius: 0.3, distance: 7, speed: 0.12, color: 0x777777 },
                    { name: "Ariel", radius: 0.32, distance: 6, speed: 0.13, color: 0x888888 }
                ],
                "Neptune": [
                    { name: "Triton", radius: 0.5, distance: 9, speed: 0.08, color: 0x99CCFF },
                    { name: "Nereid", radius: 0.2, distance: 30, speed: 0.05, color: 0xAAAAAA },
                    { name: "Proteus", radius: 0.25, distance: 7, speed: 0.1, color: 0x888888 }
                ]
            };
            
            function init() {
                // Update loading progress
                updateLoadingProgress(10);
                
                // Scene
                scene = new THREE.Scene();
                scene.background = new THREE.Color(0x0a0a2a);
                
                // Camera
                camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 3000);
                camera.position.set(0, 30, 150);
                
                updateLoadingProgress(30);
                
                // Renderer
                renderer = new THREE.WebGLRenderer({ antialias: true });
                renderer.setSize(window.innerWidth, window.innerHeight);
                renderer.setPixelRatio(window.devicePixelRatio);
                document.getElementById('solarSystem').appendChild(renderer.domElement);
                
                // Controls
                controls = new THREE.OrbitControls(camera, renderer.domElement);
                controls.enableDamping = true;
                controls.dampingFactor = 0.05;
                controls.minDistance = 20;
                controls.maxDistance = 500;
                
                updateLoadingProgress(50);
                
                // Lights
                const ambientLight = new THREE.AmbientLight(0x333333);
                scene.add(ambientLight);
                
                const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
                directionalLight.position.set(5, 10, 7);
                scene.add(directionalLight);
                
                // Create sun with corona effect
                createSun();
                
                updateLoadingProgress(70);
                
                // Create asteroid belt
                createAsteroidBelt();
                
                // Create comets
                createComets();
                
                // Create planets
                createPlanets();
                
                updateLoadingProgress(90);
                
                // Add stars background
                createStarField();
                
                // Initialize planet list
                initializePlanetList();
                
                // Events
                setupEventListeners();
                
                updateLoadingProgress(100);
                
                // Hide loading screen after a short delay
                setTimeout(() => {
                    document.getElementById('loadingScreen').style.opacity = '0';
                    setTimeout(() => {
                        document.getElementById('loadingScreen').style.display = 'none';
                    }, 500);
                }, 500);
                
                // Start animation
                animate();
            }
            
            function updateLoadingProgress(percent) {
                document.getElementById('loadingProgress').style.width = percent + '%';
            }
            
            function initializePlanetList() {
                const planetList = document.getElementById('planetList');
                planetList.innerHTML = '';
                
                planetData.forEach((planet, index) => {
                    const listItem = document.createElement('li');
                    listItem.className = 'planet-item';
                    listItem.setAttribute('data-planet', planet.name.toLowerCase());
                    listItem.innerHTML = `
                        <div class="planet-color" style="background: ${getColorString(planet.color)};"></div>
                        <span>${planet.name}</span>
                    `;
                    listItem.addEventListener('click', () => {
                        currentPlanetIndex = index;
                        openPlanetExplorer(planet);
                        zoomToPlanet(planets[index]);
                    });
                    planetList.appendChild(listItem);
                });
            }
            
            function getColorString(threeColor) {
                const color = new THREE.Color(threeColor);
                return `rgb(${Math.floor(color.r * 255)}, ${Math.floor(color.g * 255)}, ${Math.floor(color.b * 255)})`;
            }
            
            function createSun() {
                // Sun core
                const sunGeometry = new THREE.SphereGeometry(6, 32, 32);
                const sunMaterial = new THREE.MeshBasicMaterial({ 
                    color: 0xffff00,
                    emissive: 0xffff33,
                    emissiveIntensity: 0.8
                });
                sun = new THREE.Mesh(sunGeometry, sunMaterial);
                scene.add(sun);
                
                // Point light for sun
                const sunLight = new THREE.PointLight(0xffffff, 1.5, 300);
                scene.add(sunLight);
            }
            
            function createAsteroidBelt() {
                const asteroidCount = 200;
                const asteroidGeometry = new THREE.SphereGeometry(0.2, 6, 6);
                const asteroidMaterial = new THREE.MeshBasicMaterial({ color: 0x888888 });
                
                for (let i = 0; i < asteroidCount; i++) {
                    const asteroid = new THREE.Mesh(asteroidGeometry, asteroidMaterial);
                    
                    // Random position in a belt between Mars and Jupiter
                    const angle = Math.random() * Math.PI * 2;
                    const distance = 65 + Math.random() * 10;
                    
                    asteroid.position.x = Math.cos(angle) * distance;
                    asteroid.position.z = Math.sin(angle) * distance;
                    asteroid.position.y = (Math.random() - 0.5) * 2;
                    
                    scene.add(asteroid);
                }
            }
            
            function createComets() {
                const cometCount = 5;
                
                for (let i = 0; i < cometCount; i++) {
                    const cometGeometry = new THREE.SphereGeometry(0.3, 8, 8);
                    const cometMaterial = new THREE.MeshBasicMaterial({ color: 0x88CCFF });
                    const comet = new THREE.Mesh(cometGeometry, cometMaterial);
                    
                    // Random elliptical orbit
                    const a = 100 + Math.random() * 50; // semi-major axis
                    const e = 0.7 + Math.random() * 0.2; // eccentricity
                    const b = a * Math.sqrt(1 - e * e); // semi-minor axis
                    
                    comet.userData.orbit = { a, b, e, angle: Math.random() * Math.PI * 2, speed: 0.001 + Math.random() * 0.001 };
                    
                    scene.add(comet);
                    comets.push(comet);
                }
            }
            
            function createStarField() {
                const starGeometry = new THREE.BufferGeometry();
                const starCount = 5000;
                
                const positions = new Float32Array(starCount * 3);
                
                for (let i = 0; i < starCount * 3; i += 3) {
                    positions[i] = (Math.random() - 0.5) * 2000;
                    positions[i+1] = (Math.random() - 0.5) * 2000;
                    positions[i+2] = (Math.random() - 0.5) * 2000;
                }
                
                starGeometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
                
                const starMaterial = new THREE.PointsMaterial({
                    color: 0xffffff,
                    size: 1.5,
                    sizeAttenuation: true
                });
                
                const stars = new THREE.Points(starGeometry, starMaterial);
                scene.add(stars);
            }
            
            function createPlanets() {
                planetData.forEach((planet, index) => {
                    // Orbit
                    const orbitGeometry = new THREE.RingGeometry(planet.distance - 0.3, planet.distance + 0.3, 64);
                    const orbitMaterial = new THREE.MeshBasicMaterial({ 
                        color: 0x444466, 
                        side: THREE.DoubleSide,
                        transparent: true,
                        opacity: 0.2
                    });
                    const orbit = new THREE.Mesh(orbitGeometry, orbitMaterial);
                    orbit.rotation.x = Math.PI / 2;
                    scene.add(orbit);
                    orbits.push(orbit);
                    
                    // Planet
                    const planetGeometry = new THREE.SphereGeometry(planet.radius, 32, 32);
                    
                    // Create procedural texture
                    let planetMaterial;
                    if (showTextures) {
                        planetMaterial = createProceduralTexture(planet);
                    } else {
                        planetMaterial = new THREE.MeshPhongMaterial({ 
                            color: planet.color,
                            shininess: 30
                        });
                    }
                    
                    const planetMesh = new THREE.Mesh(planetGeometry, planetMaterial);
                    planetMesh.position.x = planet.distance;
                    planetMesh.userData = { ...planet, index, rotationSpeed: 0.01 / planet.radius };
                    scene.add(planetMesh);
                    planets.push(planetMesh);
                    planetMeshes.push(planetMesh);
                    
                    // Create Saturn's rings
                    if (planet.name === "Saturn") {
                        const ringGeometry = new THREE.RingGeometry(planet.radius + 1, planet.radius + 3, 64);
                        const ringMaterial = new THREE.MeshBasicMaterial({ 
                            color: 0xE3E0C0, 
                            side: THREE.DoubleSide,
                            transparent: true,
                            opacity: 0.7
                        });
                        const ring = new THREE.Mesh(ringGeometry, ringMaterial);
                        ring.rotation.x = Math.PI / 2;
                        planetMesh.add(ring);
                        planetMesh.userData.ring = ring;
                    }
                    
                    // Create moons for this planet
                    if (moonData[planet.name] && showMoons) {
                        createMoons(planet.name, planetMesh);
                    }
                    
                    // Label
                    const div = document.createElement('div');
                    div.className = 'planet-label';
                    div.style.position = 'absolute';
                    div.style.color = 'white';
                    div.style.fontSize = '14px';
                    div.style.fontWeight = 'bold';
                    div.style.textShadow = '0 0 5px black';
                    div.style.pointerEvents = 'none';
                    div.textContent = planet.name;
                    document.body.appendChild(div);
                    labels.push({ element: div, planet: planetMesh });
                });
            }
            
            function createProceduralTexture(planet) {
                // Create a canvas for procedural texture
                const canvas = document.createElement('canvas');
                canvas.width = 256;
                canvas.height = 256;
                const context = canvas.getContext('2d');
                
                // Base color
                const color = new THREE.Color(planet.color);
                context.fillStyle = `rgb(${color.r * 255}, ${color.g * 255}, ${color.b * 255})`;
                context.fillRect(0, 0, canvas.width, canvas.height);
                
                // Add some random features (craters, clouds, etc.)
                context.fillStyle = 'rgba(0, 0, 0, 0.2)';
                for (let i = 0; i < 50; i++) {
                    const x = Math.random() * canvas.width;
                    const y = Math.random() * canvas.height;
                    const radius = Math.random() * 10 + 2;
                    context.beginPath();
                    context.arc(x, y, radius, 0, Math.PI * 2);
                    context.fill();
                }
                
                // Create texture from canvas
                const texture = new THREE.CanvasTexture(canvas);
                
                return new THREE.MeshPhongMaterial({ 
                    map: texture,
                    shininess: 20
                });
            }
            
            function createMoons(planetName, planetMesh) {
                const moons = moonData[planetName];
                if (!moons) return;
                
                moons.forEach(moon => {
                    const moonGeometry = new THREE.SphereGeometry(moon.radius, 16, 16);
                    const moonMaterial = new THREE.MeshPhongMaterial({ color: moon.color });
                    const moonMesh = new THREE.Mesh(moonGeometry, moonMaterial);
                    
                    // Position moon relative to its planet
                    moonMesh.position.x = moon.distance;
                    moonMesh.userData = { ...moon, parent: planetMesh };
                    
                    planetMesh.add(moonMesh);
                    moons.push(moonMesh);
                });
            }
            
            function setupEventListeners() {
                // Planet click
                const raycaster = new THREE.Raycaster();
                const mouse = new THREE.Vector2();
                
                renderer.domElement.addEventListener('click', (event) => {
                    mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
                    mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;
                    
                    raycaster.setFromCamera(mouse, camera);
                    const intersects = raycaster.intersectObjects(planets);
                    
                    if (intersects.length > 0) {
                        const planet = intersects[0].object;
                        currentPlanetIndex = planet.userData.index;
                        openPlanetExplorer(planet.userData);
                    }
                });
                
                // Planet list items
                document.querySelectorAll('.planet-item').forEach(item => {
                    item.addEventListener('click', () => {
                        const planetName = item.getAttribute('data-planet');
                        const planetIndex = planetData.findIndex(p => p.name.toLowerCase() === planetName);
                        if (planetIndex !== -1) {
                            currentPlanetIndex = planetIndex;
                            openPlanetExplorer(planetData[planetIndex]);
                            zoomToPlanet(planets[planetIndex]);
                        }
                    });
                });
                
                // Search functionality
                document.getElementById('searchInput').addEventListener('input', (e) => {
                    const searchTerm = e.target.value.toLowerCase().trim();
                    const resultsContainer = document.getElementById('searchResults');
                    
                    if (searchTerm.length === 0) {
                        resultsContainer.style.display = 'none';
                        return;
                    }
                    
                    const matchingPlanets = planetData.filter(planet => 
                        planet.name.toLowerCase().includes(searchTerm)
                    );
                    
                    resultsContainer.innerHTML = '';
                    
                    if (matchingPlanets.length > 0) {
                        matchingPlanets.forEach(planet => {
                            const resultItem = document.createElement('div');
                            resultItem.className = 'search-result-item';
                            resultItem.textContent = planet.name;
                            resultItem.addEventListener('click', () => {
                                const planetIndex = planetData.findIndex(p => p.name === planet.name);
                                if (planetIndex !== -1) {
                                    currentPlanetIndex = planetIndex;
                                    openPlanetExplorer(planet);
                                    zoomToPlanet(planets[planetIndex]);
                                    document.getElementById('searchInput').value = '';
                                    resultsContainer.style.display = 'none';
                                }
                            });
                            resultsContainer.appendChild(resultItem);
                        });
                        resultsContainer.style.display = 'block';
                    } else {
                        const noResults = document.createElement('div');
                        noResults.className = 'search-result-item';
                        noResults.textContent = 'No planets found';
                        resultsContainer.appendChild(noResults);
                        resultsContainer.style.display = 'block';
                    }
                });
                
                // Hide search results when clicking outside
                document.addEventListener('click', (e) => {
                    if (!e.target.closest('.search-container')) {
                        document.getElementById('searchResults').style.display = 'none';
                    }
                });
                
                // Controls
                document.getElementById('speed').addEventListener('input', (e) => {
                    simulationSpeed = parseFloat(e.target.value);
                    document.getElementById('speedValue').textContent = simulationSpeed.toFixed(1) + 'x';
                    document.getElementById('speedDisplay').textContent = simulationSpeed.toFixed(1) + 'x';
                });
                
                document.getElementById('toggleOrbits').addEventListener('click', (e) => {
                    const isActive = e.target.classList.contains('active');
                    orbits.forEach(orbit => orbit.visible = !isActive);
                    e.target.classList.toggle('active');
                    showNotification(isActive ? 'Orbits hidden' : 'Orbits visible');
                });
                
                // FIXED: Labels toggle button
                document.getElementById('toggleLabels').addEventListener('click', (e) => {
                    labelsVisible = !labelsVisible;
                    e.target.classList.toggle('active');
                    
                    // Toggle all labels
                    labels.forEach(label => {
                        label.element.style.display = labelsVisible ? 'block' : 'none';
                    });
                    
                    showNotification(labelsVisible ? 'Labels visible' : 'Labels hidden');
                });
                
                document.getElementById('resetView').addEventListener('click', () => {
                    controls.reset();
                    camera.position.set(0, 30, 150);
                    showNotification('View reset');
                });
                
                document.getElementById('autoRotate').addEventListener('click', (e) => {
                    autoRotate = !autoRotate;
                    e.target.classList.toggle('active');
                    showNotification(autoRotate ? 'Auto rotation enabled' : 'Auto rotation disabled');
                });
                
                document.getElementById('pauseBtn').addEventListener('click', (e) => {
                    isPaused = !isPaused;
                    e.target.innerHTML = isPaused ? '<i class="fas fa-play"></i> PLAY' : '<i class="fas fa-pause"></i> PAUSE';
                    showNotification(isPaused ? 'Simulation paused' : 'Simulation playing');
                });
                
                document.getElementById('toggleMoons').addEventListener('click', (e) => {
                    showMoons = !showMoons;
                    e.target.classList.toggle('active');
                    
                    // Toggle moon visibility
                    planets.forEach(planet => {
                        if (moonData[planet.userData.name]) {
                            planet.children.forEach(child => {
                                if (child.userData && child.userData.parent) {
                                    child.visible = showMoons;
                                }
                            });
                        }
                    });
                    
                    showNotification(showMoons ? 'Moons visible' : 'Moons hidden');
                });
                
                document.getElementById('toggleTextures').addEventListener('click', (e) => {
                    showTextures = !showTextures;
                    e.target.classList.toggle('active');
                    
                    // Recreate planets with or without textures
                    planets.forEach((planet, index) => {
                        const planetData = planet.userData;
                        const geometry = planet.geometry;
                        
                        let material;
                        if (showTextures) {
                            material = createProceduralTexture(planetData);
                        } else {
                            material = new THREE.MeshPhongMaterial({ 
                                color: planetData.color,
                                shininess: 30
                            });
                        }
                        
                        planet.material = material;
                    });
                    
                    showNotification(showTextures ? 'Textures enabled' : 'Textures disabled');
                });
                
                document.getElementById('closeExplorer').addEventListener('click', () => {
                    closePlanetExplorer();
                });
                
                document.getElementById('prevPlanet').addEventListener('click', () => {
                    currentPlanetIndex = (currentPlanetIndex - 1 + planetData.length) % planetData.length;
                    openPlanetExplorer(planetData[currentPlanetIndex]);
                });
                
                document.getElementById('nextPlanet').addEventListener('click', () => {
                    currentPlanetIndex = (currentPlanetIndex + 1) % planetData.length;
                    openPlanetExplorer(planetData[currentPlanetIndex]);
                });
                
                // Tour controls
                document.getElementById('startTour').addEventListener('click', () => {
                    if (isTourActive) {
                        stopTour();
                    } else {
                        startTour();
                    }
                });
                
                document.getElementById('nextStop').addEventListener('click', () => {
                    if (isTourActive) {
                        nextTourStop();
                    }
                });
                
                // Keyboard shortcuts
                document.addEventListener('keydown', (e) => {
                    switch(e.key.toLowerCase()) {
                        case 'p':
                            isPaused = !isPaused;
                            document.getElementById('pauseBtn').innerHTML = isPaused ? '<i class="fas fa-play"></i> PLAY' : '<i class="fas fa-pause"></i> PAUSE';
                            showNotification(isPaused ? 'Simulation paused' : 'Simulation playing');
                            break;
                        case 'r':
                            controls.reset();
                            camera.position.set(0, 30, 150);
                            showNotification('View reset');
                            break;
                        case 'escape':
                            closePlanetExplorer();
                            stopTour();
                            break;
                        case 'arrowleft':
                            currentPlanetIndex = (currentPlanetIndex - 1 + planetData.length) % planetData.length;
                            openPlanetExplorer(planetData[currentPlanetIndex]);
                            break;
                        case 'arrowright':
                            currentPlanetIndex = (currentPlanetIndex + 1) % planetData.length;
                            openPlanetExplorer(planetData[currentPlanetIndex]);
                            break;
                        case 't':
                            if (isTourActive) {
                                stopTour();
                            } else {
                                startTour();
                            }
                            break;
                    }
                });
                
                window.addEventListener('resize', () => {
                    camera.aspect = window.innerWidth / window.innerHeight;
                    camera.updateProjectionMatrix();
                    renderer.setSize(window.innerWidth, window.innerHeight);
                });
            }
            
            function openPlanetExplorer(planetData) {
                document.getElementById('explorerPlanetName').textContent = planetData.name;
                document.getElementById('planetOverview').textContent = planetData.overview;
                
                // Update stats
                const statsContainer = document.getElementById('planetStats');
                statsContainer.innerHTML = `
                    <div class="stat-card">
                        <div class="stat-title">TYPE</div>
                        <div class="stat-value">${planetData.type}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-title">DIAMETER</div>
                        <div class="stat-value">${planetData.diameter}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-title">DISTANCE FROM SUN</div>
                        <div class="stat-value">${planetData.distance} AU*</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-title">ORBITAL PERIOD</div>
                        <div class="stat-value">${planetData.orbitalPeriod}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-title">ROTATION PERIOD</div>
                        <div class="stat-value">${planetData.rotationPeriod}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-title">AVG TEMPERATURE</div>
                        <div class="stat-value">${planetData.temperature}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-title">GRAVITY</div>
                        <div class="stat-value">${planetData.gravity}</div>
                    </div>
                `;
                
                // Update highlights
                const highlightsContainer = document.getElementById('planetHighlights');
                highlightsContainer.innerHTML = '';
                planetData.highlights.forEach(highlight => {
                    const highlightEl = document.createElement('div');
                    highlightEl.className = 'highlight';
                    highlightEl.innerHTML = `
                        <i class="fas fa-star"></i>
                        <span>${highlight}</span>
                    `;
                    highlightsContainer.appendChild(highlightEl);
                });
                
                // Update moons
                const moonsContainer = document.getElementById('planetMoons');
                moonsContainer.innerHTML = '';
                planetData.moons.forEach(moon => {
                    const moonEl = document.createElement('div');
                    moonEl.className = 'mission-tag';
                    moonEl.textContent = moon;
                    moonsContainer.appendChild(moonEl);
                });
                
                // Update missions
                const missionsContainer = document.getElementById('planetMissions');
                missionsContainer.innerHTML = '';
                planetData.missions.forEach(mission => {
                    const missionEl = document.createElement('div');
                    missionEl.className = 'mission-tag';
                    missionEl.textContent = mission;
                    missionsContainer.appendChild(missionEl);
                });
                
                // Create a simple 3D model for the planet in the explorer
                const modelContainer = document.getElementById('planetModel');
                modelContainer.innerHTML = '';
                
                const modelScene = new THREE.Scene();
                const modelCamera = new THREE.PerspectiveCamera(50, 1, 0.1, 1000);
                modelCamera.position.z = 5;
                
                const modelRenderer = new THREE.WebGLRenderer({ alpha: true });
                modelRenderer.setSize(300, 300);
                modelContainer.appendChild(modelRenderer.domElement);
                
                const geometry = new THREE.SphereGeometry(2, 32, 32);
                let material;
                if (showTextures) {
                    material = createProceduralTexture(planetData);
                } else {
                    material = new THREE.MeshPhongMaterial({ 
                        color: planetData.color,
                        shininess: 30
                    });
                }
                const planetModel = new THREE.Mesh(geometry, material);
                modelScene.add(planetModel);
                
                const light = new THREE.PointLight(0xffffff, 1, 100);
                light.position.set(5, 5, 5);
                modelScene.add(light);
                
                const ambientLight = new THREE.AmbientLight(0x404040);
                modelScene.add(ambientLight);
                
                function animateModel() {
                    requestAnimationFrame(animateModel);
                    planetModel.rotation.y += 0.01;
                    modelRenderer.render(modelScene, modelCamera);
                }
                animateModel();
                
                // Show the explorer
                document.getElementById('planetExplorer').classList.add('active');
                
                showNotification(`Exploring ${planetData.name}`);
            }
            
            function closePlanetExplorer() {
                document.getElementById('planetExplorer').classList.remove('active');
            }
            
            function zoomToPlanet(planet) {
                const planetPosition = planet.position.clone();
                const direction = planetPosition.clone().normalize();
                const zoomDistance = planet.userData.radius * 5 + 10;
                
                // Animate camera to planet
                const targetPosition = planetPosition.clone().add(direction.multiplyScalar(zoomDistance));
                
                // Smooth camera transition
                const startPosition = camera.position.clone();
                const startTime = Date.now();
                const duration = 1500; // ms
                
                function animateCamera() {
                    const elapsed = Date.now() - startTime;
                    const progress = Math.min(elapsed / duration, 1);
                    
                    // Easing function
                    const ease = 1 - Math.pow(1 - progress, 3);
                    
                    camera.position.lerpVectors(startPosition, targetPosition, ease);
                    controls.target.lerpVectors(controls.target, planetPosition, ease);
                    
                    if (progress < 1) {
                        requestAnimationFrame(animateCamera);
                    }
                }
                
                animateCamera();
                showNotification(`Zoomed to ${planet.userData.name}`);
            }
            
            function startTour() {
                isTourActive = true;
                document.getElementById('startTour').classList.add('active');
                document.getElementById('startTour').innerHTML = '<i class="fas fa-stop"></i> STOP TOUR';
                
                currentPlanetIndex = 0;
                openPlanetExplorer(planetData[currentPlanetIndex]);
                zoomToPlanet(planets[currentPlanetIndex]);
                
                // Set up automatic tour progression
                tourInterval = setInterval(() => {
                    nextTourStop();
                }, 8000); // 8 seconds per planet
                
                showNotification('Tour started');
            }
            
            function stopTour() {
                isTourActive = false;
                document.getElementById('startTour').classList.remove('active');
                document.getElementById('startTour').innerHTML = '<i class="fas fa-play"></i> START TOUR';
                
                if (tourInterval) {
                    clearInterval(tourInterval);
                }
                
                showNotification('Tour stopped');
            }
            
            function nextTourStop() {
                if (!isTourActive) return;
                
                currentPlanetIndex = (currentPlanetIndex + 1) % planetData.length;
                openPlanetExplorer(planetData[currentPlanetIndex]);
                zoomToPlanet(planets[currentPlanetIndex]);
            }
            
            function updateLabels() {
                labels.forEach(label => {
                    const planet = label.planet;
                    const vector = planet.position.clone();
                    vector.project(camera);
                    
                    // Check if planet is behind camera
                    if (vector.z > 1) {
                        label.element.style.display = 'none';
                        return;
                    }
                    
                    const x = (vector.x * 0.5 + 0.5) * window.innerWidth;
                    const y = (-vector.y * 0.5 + 0.5) * window.innerHeight;
                    
                    // Center the label
                    label.element.style.left = (x - label.element.offsetWidth/2) + 'px';
                    label.element.style.top = (y - label.element.offsetHeight/2) + 'px';
                    
                    // Only show if labels are enabled
                    label.element.style.display = labelsVisible ? 'block' : 'none';
                });
            }
            
            function updatePositionDisplay() {
                const now = new Date();
                const positions = planets.map(planet => {
                    const data = planet.userData;
                    return `${data.name}: ${data.distance} AU`;
                }).join(' | ');
                
                document.getElementById('positionDisplay').textContent = 
                    `Real-time positions: ${now.toLocaleTimeString()} | ${positions}`;
            }
            
            function showNotification(message) {
                const notification = document.getElementById('notification');
                const notificationText = document.getElementById('notificationText');
                notificationText.textContent = message;
                notification.classList.add('show');
                
                setTimeout(() => {
                    notification.classList.remove('show');
                }, 3000);
            }
            
            function animate() {
                requestAnimationFrame(animate);
                
                if (!isPaused) {
                    // Update planets
                    planets.forEach((planet, i) => {
                        const data = planetData[i];
                        const angle = Date.now() * 0.001 * data.speed * simulationSpeed;
                        planet.position.x = Math.cos(angle) * data.distance;
                        planet.position.z = Math.sin(angle) * data.distance;
                        
                        // Rotate planet on its axis
                        planet.rotation.y += planet.userData.rotationSpeed * simulationSpeed;
                    });
                    
                    // Update moons
                    planets.forEach(planet => {
                        if (moonData[planet.userData.name] && showMoons) {
                            planet.children.forEach((moon, i) => {
                                if (moon.userData && moon.userData.parent) {
                                    const moonData = moon.userData;
                                    const moonAngle = Date.now() * 0.001 * moonData.speed * simulationSpeed;
                                    moon.position.x = Math.cos(moonAngle) * moonData.distance;
                                    moon.position.z = Math.sin(moonAngle) * moonData.distance;
                                }
                            });
                        }
                    });
                    
                    // Update comets
                    comets.forEach(comet => {
                        const orbit = comet.userData.orbit;
                        orbit.angle += orbit.speed * simulationSpeed;
                        
                        // Elliptical orbit calculation
                        const x = orbit.a * Math.cos(orbit.angle);
                        const z = orbit.b * Math.sin(orbit.angle);
                        
                        comet.position.set(x, 0, z);
                    });
                }
                
                // Auto rotation
                if (autoRotate) {
                    controls.autoRotate = true;
                    controls.autoRotateSpeed = 0.5;
                } else {
                    controls.autoRotate = false;
                }
                
                controls.update();
                updateLabels();
                updatePositionDisplay();
                renderer.render(scene, camera);
            }
            
            // Start
            init();
        }
    </script>
</body>
</html>
